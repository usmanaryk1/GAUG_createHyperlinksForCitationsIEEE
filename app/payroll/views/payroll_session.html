
<div class="page-body"> 


    <!--PAGE TITLE START -->
    <div class="page-title">
        <div class="title-env">
            <h1 class="title">Payroll Session</h1>
            <p class="description">Run New Payroll Session For Your Employees</p>
        </div>
    </div>
    <!--PAGE TITLE END -->
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <form class="form-horizontal" role="form">
                        <div class="row">
                            <div class="col-sm-12 no-padding">

                                <div class="form-group col-sm-5 pull-left">
                                    <label class="col-sm-4 control-label pull-left" style="min-width:110px;"><span style="float:left;">Show Entries</span></label>
                                    <div style="width:70px; float:left">
                                        <select class="form-control" ng-model="payrollSession.viewRecords" ng-change="payrollSession.changeViewRecords()">
                                            <option value="10">10</option>
                                            <option value="25">25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                    </div>
                                </div>
                                <div ng-if="payrollSession.processdMode" class="col-sm-7 no-padding">
                                    <div class="pull-right text-right">
                                        Payroll Batch Number: {{payrollSession.processedSessionObj.id}}
                                    </div>
                                    <br/>
                                    <div class="pull-right text-right">
                                        Pay Period: {{payrollSession.processedSessionObj.sessionStartDate|date :dateFormat}} - {{payrollSession.processedSessionObj.sessionEndDate|date :dateFormat}}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" ng-if="!payrollSession.processdMode">
                            <div class="col-sm-12 pad0">
                                <div class="col-sm-6 pull-right wd_full">
                                    <div class="col-sm-6 pad0 wd_full">
                                        <div class="form-group">
                                            <label for="field-93" class="col-sm-3 control-label">From</label>
                                            <div class="col-sm-9">
                                                <div class="input-group">
                                                    <input type="text" id="field-93" class="form-control datepicker" data-format="mm/dd/yyyy" ng-model="payrollSession.searchParams.fromDate" max-date="payrollSession.searchParams.toDate"/>
                                                    <div class="input-group-addon"> <a href="#"><i class="linecons-calendar"></i></a> </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 pad0">
                                        <div class="form-group">
                                            <label for="field-94" class="col-sm-3 control-label">To</label>
                                            <div class="col-sm-9">
                                                <div class="input-group">
                                                    <input type="text" id="field-94" class="form-control datepicker" data-format="mm/dd/yyyy" ng-model="payrollSession.searchParams.toDate" min-date="payrollSession.searchParams.fromDate"/>
                                                    <div class="input-group-addon"> <a href="#"><i class="linecons-calendar"></i></a> </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 pad0">
                            <div class="pull-right" ng-if="!payrollSession.processdMode">
                                <button type="button" class="btn btn-info btn-single process_bt pull-right" ng-click="payrollSession.processSessions()">Process</button>
                                <button type="button" class="btn btn-info green_bt  pull-right" ng-click="payrollSession.filterSessions()">Review</button>
                                <a ng-if="payrollSession.criteriaSelected" href="javascript:;" ng-click="payrollSession.showAddEmployeeModal()" class="btn btn-info edit_bt  pull-right">Add Employee</a>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="panel-body pad_top0">
                    <div>
                        <div class=" border0 search_hide">
                            <table id="example-1" class="table table-striped table-bordered  table table-small-font table-bordered table-striped" cellspacing="0" ng-if="payrollSession.payrollSessions.length" datatable-setup datatable-obj="payrollSession.datatableObj">
                                <thead>
                                    <tr>
                                        <th nowrap><span class="wd80">Last Name</span></th>
                                        <th nowrap><span class="wd80">First Name</span></th>
                                        <th nowrap><span class="wd80">Gross Pay</span></th>

                                        <th nowrap><span class="wd60">Rate 1</span></th>
                                        <th nowrap><span class="tb_width">Hours 1 </span></th>
                                        <th nowrap><span class="wd60">Rate 2</span></th>

                                        <th nowrap><span class="tb_width">Hours 2</span></th>
                                        <th nowrap><span class="tb_width">OT Rate</span></th>
                                        <th nowrap><span class="tb_width">OT Hours</span></th>
                                        <th nowrap><span class="tb_width">HD Rate</span></th>
                                        <th nowrap><span class="tb_width">HD Hours</span></th>
                                        <!--                                        <th nowrap><span class="wd60">Hours</span></th>
                                        
                                                                                <th nowrap><span class="wd98">1099 Earnings</span></th>-->
                                        <!--                                        <th nowrap><span class="tb_width">Vacation</span></th>
                                                                                <th nowrap><span class="wd50">Sick</span></th>
                                        
                                                                                <th nowrap><span class="tb_width">Personal</span></th>
                                                                                <th nowrap><span class="tb_width">Holiday</span></th>
                                                                                <th nowrap><span class="wd110">Bonus Earnings</span></th>
                                        
                                                                                <th nowrap><span class="wd110">Misc Earnings</span></th>
                                                                                <th nowrap><span class="wd110">Misc Deduction</span></th>
                                                                                <th nowrap><span class="wd50">Loan</span></th>
                                        
                                                                                <th nowrap><span class="wd110">ADP 401k Loan</span></th>
                                                                                <th nowrap><span class="wd130">ADP 401k Deduction</span></th>
                                                                                <th nowrap><span class="wd130">Advance Deduction</span></th>-->

                                        <th><span class="wd50">Notes</span></th>
                                        <th nowrap>
                                            <span class="wd60">Actions</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="session in payrollSession.payrollSessions">
                                        <th><span class="fa-user" tooltip="Manually Added" ng-if="session.manuallyAdded"></span> {{payrollSession.empMap[session.employeeId].lName}}</th>
                                        <td>{{payrollSession.empMap[session.employeeId].fName}}</td>
                                        <td> ${{session.grossPay| number:2}}</td>
                                        <td>${{session.rate1 == null ? 0 : session.rate1| number:2}}</td>
                                        <td>{{session.hour1 == null ? 0 : session.hour1| number:2}}</td>
                                        <td>${{session.rate2 == null ? 0 : session.rate2| number:2}}</td>
                                        <td>{{session.hour2 == null ? 0 : session.hour2| number:2}}</td>
                                        <td>{{session.otRate == null ? 0 : session.otRate| number:2}}</td>
                                        <td>{{session.otHours == null ? 0 : session.otHours| number:2}}</td>
                                        <td>{{session.hdRate == null ? 0 : session.hdRate| number:2}}</td>
                                        <td>{{session.hdHours == null ? 0 : session.hdHours| number:2}}</td>
                                        <!--                                        <td>{{session.totalHours}}</td>
                                                                                <td>{{session.1Earnings}}</td>-->
                                        <!--                                        <td>37</td>
                                                                                <td>87</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>
                                                                                <td>21</td>-->
                                        <td><a href="javascript:;" ng-click="payrollSession.editNotes(session)" class="fa fa-file-text-o file btn" ></a> 
                                        </td>
                                        <td>
                                            <div class="center">
                                                <a ng-if="!payrollSession.processdMode" class="btn icon-left fa fa-pencil edit_button" ng-click="payrollSession.openPayrollModal(session, 'payrollModal', 'lg')" tooltip="Edit" tooltip-append-to-body="true"><span class="ed_b"></span></a> 
                                                <a href="" style="color:blue" ng-if="payrollSession.processdMode" ng-click="payrollSession.openPayrollModal(session, 'payrollModal', 'lg')" tooltip="View" tooltip-append-to-body="true">View</a> 
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div ng-if="(payrollSession.payrollSessions == null || payrollSession.payrollSessions.length == 0) && payrollSession.dataRetrieved && payrollSession.criteriaSelected === true">
                                No payrolls are available for selected date range.
                            </div>
                            <div ng-if="payrollSession.criteriaSelected == false && !payrollSession.processdMode && !payrollSession.processClicked">
                                Please select all filters to review payrolls.
                            </div>
                            <div ng-if="payrollSession.criteriaSelected == false && !payrollSession.processdMode && payrollSession.processClicked">
                                Please review payrolls to process sessions.
                            </div>
                        </div>
                        <div ng-if="payrollSession.processdMode">
                            <div class="col-sm-6">
                                Total Employees: {{payrollSession.processedSessionObj.totalEmployees}}
                            </div>
                            <div class="col-sm-6 text-right">
                                Total Gross Pay: ${{payrollSession.totalGrossPay| number:2}}
                            </div>
                        </div>
                        <script type="text/javascript">
                            // This JavaScript Will Replace Checkboxes in dropdown toggles
                            jQuery(document).ready(function($)
                            {
                                setTimeout(function()
                                {
                                    $(".checkbox-row input").addClass('cbr');
                                    cbr_replace();
                                }, 0);
                            });
                        </script>

                    </div>

                </div>
            </div>
        </div>
    </div>

</div>


<!-- Modal 7 (Ajax Modal)-->
<div class="modal fade" id="modal-7" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog width800">
        <div class="modal-content">
            <form class="form-horizontal validate" name="addEmployeeForm" id="addEmployeeForm" role="form" ng-submit="payrollSession.addEmployee()">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Add Employee</h4>
                </div>

                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-sm-3 control-label">Employee</label>
                        <div class="col-sm-9"> 
                            <script type="text/javascript">
//                                jQuery(document).ready(function($)
//                                {
//                                    setTimeout(function() {
//                                        $("#sboxit-1").select2({
////                                                        minimumResultsForSearch: -1,
//                                            placeholder: 'Select Employee...',
////                                                        minimumInputLength: 1,
////                                                        placeholder: 'Search',
//                                        }).on('select2-open', function()
//                                        {
//                                            // Adding Custom Scrollbar
//                                            $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
//                                        });
//                                    }, 200);
//
//                                });
                            </script>
                            <select class="form-control" id="sboxit-1" ng-model="payrollSession.employeeModalObj.employeeId" ng-options='emp.id as (emp.lName+", "+emp.fName+" "+emp.middleInitial) for emp in payrollSession.addEmployeeList track by emp.id' ng-change="payrollSession.selectEmployee()">
                                <option value="" selected hidden />
                            </select>
                            <div ng-show='payrollSession.employeeModalObj.employeeId == null && payrollSession.payrollFormSubmitted'>
                                <span style='color: #cc3f44;display: block;font-size: 12px;padding-top: 5px;'>Please select Employee.</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="grossPay">
                            Gross Pay
                        </label>
                        <div class="col-sm-3">
                            <input ng-disabled="true" class="form-control" id="grossPay" name="grossPay" type="text" ng-model="payrollSession.employeeModalObj.grossPay" maxlength="5" numbers-only="true" decimalallowed="true" data-validate="number"/>
                        </div>
                        <label class="col-sm-3 control-label" for="earnings">
                            1099 Earnings
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="earnings" name="earnings" type="text" ng-model="payrollSession.employeeModalObj.earnings1099" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>

                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="rate1">
                            Rate 1
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="rate1" name="rate1" type="text" ng-model="payrollSession.employeeModalObj.rate1" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>
                        <label class="col-sm-3 control-label" for="hours1">
                            Hours 1
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="hours1" name="hours1" type="text" ng-model="payrollSession.employeeModalObj.hour1" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>                        
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="rate2">
                            Rate 2
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="rate2" name="rate2" type="text" ng-model="payrollSession.employeeModalObj.rate2" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>
                        <label class="col-sm-3 control-label" for="hours2">
                            Hours 2
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="hours2" name="hours2" type="text" ng-model="payrollSession.employeeModalObj.hour2" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>                        
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="otRate">
                            OT Rate
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="otRate" name="otRate" type="text" ng-model="payrollSession.employeeModalObj.otRate" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>
                        <label class="col-sm-3 control-label" for="otHours">
                            OT Hours
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="otHours" name="otHours" type="text" ng-model="payrollSession.employeeModalObj.otHours" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>                       
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="hdRate">
                            HD Rate
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="hdRate" name="hdRate" type="text" ng-model="payrollSession.employeeModalObj.hdRate" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>
                        <label class="col-sm-3 control-label" for="hdHours">
                            HD Hours
                        </label>
                        <div class="col-sm-3">
                            <input class="form-control" id="hdHours" name="hdHours" type="text" ng-model="payrollSession.employeeModalObj.hdHours" maxlength="5" ng-change="payrollSession.setGrossPay(payrollSession.employeeModalObj)" numbers-only="true" data-validate="number" decimalallowed="true"/>
                        </div>                       
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-info green_bt">Add</button>
                </div>
            </form>

        </div>
    </div>
</div>


<div class="modal fade" id="modal-8" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" ng-click="payrollSession.closeNotes()" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Review</h4>
            </div>

            <div class="modal-body">
                <textarea ng-disabled="payrollSession.processdMode" class="form-control" rows="10" ng-model="payrollSession.selectedSession.notes">
                </textarea>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-white" ng-click="payrollSession.closeNotes()">Close</button>
                <button type="button" ng-if="!payrollSession.processdMode" class="btn btn-info" ng-click="payrollSession.saveNotes()">Save Notes</button>
            </div>
        </div>
    </div>
</div>

<script type="text/ng-template" id="payrollModal">
    <form class="validate form-horizontal" name="payrollForm" id="payroll_form" >
    <div class="modal-header">
    <button type="button" class="close" ng-click="payrollModal.cancel();" aria-hidden="true">&times;</button>
    <h4 class="modal-title">
    {{payrollModal.empMap[payrollModal.payrollObj.employeeId].lName +' '+payrollModal.empMap[payrollModal.payrollObj.employeeId].fName}} - Payroll Information
    </h4>
    </div>

    <div class="modal-body">

    <div class="form-group">
    <label class="col-sm-3 control-label" for="vacation">
    Vacation
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="vacation" ng-disabled="payrollModal.processdMode" name="vacation" type="text" ng-model="payrollModal.payrollObj.vacation" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    <label class="col-sm-3 control-label" for="Sick">
    Sick
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="sick" ng-disabled="payrollModal.processdMode" name="sick" type="text" ng-model="payrollModal.payrollObj.sick" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    </div>
    <div class="form-group">
    <label class="col-sm-3 control-label" for="personal">
    Personal
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="personal" ng-disabled="payrollModal.processdMode" name="personal" type="text" ng-model="payrollModal.payrollObj.personal" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    <label class="col-sm-3 control-label" for="bonusEarnings">
    Bonus Earnings
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="bonusEarnings" ng-disabled="payrollModal.processdMode" name="bonusEarnings" type="text" ng-model="payrollModal.payrollObj.bonusEarnings" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    </div>
    <div class="form-group">
    <label class="col-sm-3 control-label" for="miscEarnings">
    Misc Earnings
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="miscEarnings" ng-disabled="payrollModal.processdMode" name="miscEarnings" type="text" ng-model="payrollModal.payrollObj.miscEarnings" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    <label class="col-sm-3 control-label" for="miscDeduction">
    Misc Deduction
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="miscDeduction" ng-disabled="payrollModal.processdMode" name="miscDeduction" type="text" ng-model="payrollModal.payrollObj.miscDeduction" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    </div>
    <div class="form-group">
    <label class="col-sm-3 control-label" for="loan">
    Loan
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="loan" ng-disabled="payrollModal.processdMode" name="loan" type="text" ng-model="payrollModal.payrollObj.loan" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    <label class="col-sm-3 control-label" for="adpLoan">
    401k Loan
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="adpLoan" ng-disabled="payrollModal.processdMode" name="adpLoan" type="text" ng-model="payrollModal.payrollObj.adp401kLoan" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    </div>
    <div class="form-group">
    <label class="col-sm-3 control-label" for="adpDeduction">
    401k Deduction
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="adpDeduction" ng-disabled="payrollModal.processdMode" name="adpDeduction" type="text" ng-model="payrollModal.payrollObj.adp401kDeduction" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    <label class="col-sm-3 control-label" for="advanceDeduction">
    Advance Deduction
    </label>
    <div class="col-sm-3">
    <input class="form-control" id="advanceDeduction" ng-disabled="payrollModal.processdMode" name="advanceDeduction" type="text" ng-model="payrollModal.payrollObj.advanceDeduction" maxlength="5" numbers-only="true" data-validate="number" decimalallowed="true"/>
    </div>
    </div>
    </div>
    <div class="modal-footer">
    <button type="button" class="btn btn-white" ng-click="payrollModal.cancel();">Close</button>
    <button type="button" ng-if="!payrollModal.processdMode" class="btn btn-info" ng-click="payrollModal.save();">Save changes</button>
    </div>
    </form>
</script>
