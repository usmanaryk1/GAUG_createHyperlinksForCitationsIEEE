<div class="row" ng-init="addPatient.tab4DataInit()">
    <div class="col-sm-12">
        <div class="panel panel-default">
            <div class="panel-body">
                <form class="form-horizontal validate" id="add_patient_form" novalidate="" name="add_patient_form" role="form" ng-submit="addPatient.savePatient()">
                    <div class="row">
                        <div class="col-sm-12">
                            <button class="btn btn-info green_bt pull-right" type="submit" ng-disabled="addPatient.disableSaveButton" ng-click="addPatient.setFromNext('tab4')">
                                Save Changes
                            </button>
                            <button class="btn btn-info btn-single gray_bt pull-right" type="reset" ng-click="addPatient.resetPatient()">
                                Reset To Default
                            </button>
                        </div>
                    </div>
                    <div class="form-group-separator">
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            Care Type
                        </label>
                        <div class="col-sm-9">
                            <script type="text/javascript">
                                jQuery(document).ready(function ($)
                                {
                                    $("#multi-select").multiSelect({
                                        afterInit: function ()
                                        {
                                            // Add alternative scrollbar to list
                                            this.$selectableContainer.add(this.$selectionContainer).find('.ms-list').perfectScrollbar();
                                        },
                                        afterSelect: function ()
                                        {
                                            // Update scrollbar size
                                            this.$selectableContainer.add(this.$selectionContainer).find('.ms-list').perfectScrollbar('update');
                                        }
                                    });
                                });
                            </script>
                            <select class="form-control" id="CareTypes" multiple="multiple" name="CareTypes"
                                    data-validate="required" data-message-required="Please select Care Type." ng-model="addPatient.careTypes"  ng-change="addPatient.displayCareTypeModal = true"
                                    ng-options='ct.id as ct.companyCaretypeId.careTypeTitle for ct in addPatient.careTypeList'>
                                <!--                                <option ng-repeat="ct in addPatient.careTypeList" ng-value="{{ct.id}}">
                                                                    {{ct.careTypeTitle}}
                                                                </option>-->
                                <!--                                <option value="1">
                                    Silky Door
                                </option>
                                <option value="2">
                                    The Absent Twilight
                                </option>
                                <option value="3">
                                    Tales of Flames
                                </option>
                                <option value="4">
                                    The Princess's Dream
                                </option>
                                <option value="5">
                                    The Fairy of the Wind
                                </option>
                                <option value="6">
                                    Children in the Boy
                                </option>
                                <option value="7">
                                    Frozen Savior
                                </option>
                                <option value="8">
                                    The Missing Thorns
                                </option>
                                <option value="9">
                                    Healing of Serpent
                                </option>
                                <option value="10">
                                    The Voyagers's Girlfriend
                                </option>
                                <option value="11">
                                    The Nothing of the Gate
                                </option>
                                <option value="12">
                                    Healing in the Scent
                                </option>
                                <option value="13">
                                    Final Twins
                                </option>
                                <option value="14">
                                    The Willing Rose
                                </option>
                                <option value="15">
                                    Thorn of Emperor
                                </option>
                                <option value="16">
                                    The Predator's Pirates
                                </option>
                                <option value="17">
                                    The Lord of the Girl
                                </option>
                                <option value="18">
                                    Flowers in the Spirit
                                </option>
                                <option value="19">
                                    Healing in the Silence
                                </option>
                                <option value="20">
                                    Planet of Bridges
                                </option>-->
                            </select>
                        </div>
                    </div>
                    <div class="form-group-separator">
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="StartDate">
                            Start Date
                        </label>
                        <div class="col-sm-9">
                            <div class="input-group">
                                <input class="form-control datepicker" data-format="mm/dd/yyyy" id="StartDate" 
                                       name="StartDate" type="text" ng-model="addPatient.patient.authorizationStartDate"
                                       data-validate="required"  data-message-required="Please enter Start Date." max-date="addPatient.patient.authorizationEndDate">
                                <div class="input-group-addon">
                                    <a href="#">
                                        <i class="linecons-calendar">
                                        </i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>  
                    <div class="form-group-separator">
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="field-37">
                            Diagnosis Code
                        </label>
                        <div class="col-sm-9">
                            <input class="form-control" id="field-37" name="Diagnosis" type="text" ng-model="addPatient.patient.diagnosisCode"/>
                        </div>
                    </div>
                    <div class="form-group-separator">
                    </div>
                    <div class="form-group">

                        <div class="col-md-12">

                            <div class="panel panel-default panel-table" style="padding: 0;" id="authorizationDocuments">
                                <div class="panel-heading" style="border-bottom: none;">
                                    <div class="row">
                                        <div class="col col-xs-6">
                                            <h3 class="panel-title">Uploaded Authorizations</h3>
                                        </div>
                                        <div class="col col-xs-6 text-right">
                                            <button type="button" class="btn btn-sm btn-info btn-create" ng-click="addPatient.createOrEditAuthorizationDocument();">Add New Authorization</button>
                                        </div>
                                    </div>
                                </div>
                                <div ng-if="addPatient.authorizationDocuments && addPatient.authorizationDocuments.length > 0">
                                    <table class="table table-striped table-bordered table-list table-attachments">
                                        <thead>
                                            <tr>

                                                <th class="hidden-xs text-center">ID</th>
                                                <th class="text-center">Care Type</th>
                                                <th class="text-center">Authorization Hours</th>
                                                <th class="text-center">Authorization Number</th>
                                                <th class="text-center">Authorization Date</th>
                                                <th class="text-center"><em class="fa fa-cog"></em></th>

                                            </tr> 
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="authDocument in addPatient.authorizationDocuments">
                                                <td class="hidden-xs text-center">{{$index + 1}}</td>
                                                <td align="center" tooltip="{{addPatient.careTypeIdMap[authDocument.careType].billingCode!=null?'Billing Code: '+addPatient.careTypeIdMap[authDocument.careType].billingCode:''}}" tooltip-append-to-body="true">{{authDocument.careTypeTitle}}</td>
                                                <td align="center">{{authDocument.authorizedHours}}</td>
                                                <td align="center">
                                                    {{authDocument.authorizationNumber}}                                                    
                                                </td> 
                                                <td align="center"><span ng-if="authDocument.startDate != null">{{authDocument.startDate|date:dateFormat}} -</span> {{authDocument.expiryDate|date:dateFormat}}</td> 
                                                <td align="center">
                                                    <a class="btn btn-warning btn-sm" ng-click="addPatient.openPasswordModal($index)" ng-if="authDocument.careType"><em class="fa fa-pencil"></em></a>
                                                    <span ng-if="authDocument.id === null || authDocument.id === undefined">
                                                        &nbsp;&nbsp;
                                                        <a class="btn btn-danger btn-sm" ng-click="addPatient.removeAuthorizationDocument($index);" ><em class="fa fa-trash"></em></a>
                                                    </span>
                                                    <span>
                                                        &nbsp;&nbsp;
                                                        <a class="btn btn-success btn-sm"  ng-href="{{addPatient.baseUrl}}file/download/{{addPatient.companyCode}}/p/{{authDocument.filePath}}?userFileName={{authDocument.name}}" tooltip="{{authDocument.name}}.{{authDocument.filePath.substring(authDocument.filePath.lastIndexOf('.') + 1)}}"><em class="fa fa-download "></em></a>
                                                    </span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                                <div ng-if="!addPatient.authorizationDocuments || addPatient.authorizationDocuments.length === 0" class="text-center">
                                    No Authorization Documents Found.
                                </div>
                            </div>


                            <!--                            <div flow-init="addPatient.uploadFile" flow-file-added="addPatient.fileAdded($file, $flow)" flow-file-success="addPatient.fileUploaded($message,$file,$flow)" flow-files-submitted="addPatient.fileSelected($file,$flow)" flow-file-error="addPatient.fileError( $file, $message, $flow )">
                                                            <div class="row">
                                                                <div class="col-sm-3">
                                                                    <button type='button' class='btn btn-single gray_bt' id="contract_file" ng-model="addPatient.patient.authorization" flow-btn style="margin-bottom:0px !important" name="contract_file" ng-disabled="addPatient.disableUploadButton">Choose File</button>
                                                                </div>
                                                                <div class="col-sm-9">
                                                                    <label class="control-label">
                                                                        <a style="color: blue;text-decoration: underline" ng-href="{{addPatient.baseUrl}}file/download/{{addPatient.companyCode}}/p/{{addPatient.patient.authorization}}">
                                                                            authorization{{addPatient.patient.authorization|extension}}
                                                                        </a>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div ng-show="addPatient.fileObj.errorMsg != null && addPatient.fileObj.errorMsg != ''">
                                                                    <span class="red">{{addPatient.fileObj.errorMsg}}</span>
                                                                </div> 
                                                            </div>
                                                            <div flow-transfers class="form-control-static" ng-show="transfers != null && transfers.length > 0 && transfers[0].progress() < 1">
                                                                <div ng-repeat="file in transfers">
                                                                    <div id="docFileprogress" class="progress" ng-show="file.progress() < 1 && addPatient.showfileProgress">
                                                                        <div  class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: {{file.progress() * 100}}%;">
                                                                            {{file.progress() * 100 | number : 0}} %
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>-->

                        </div>
                    </div>
                    <!--                <div class="form-group-separator">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label" >
                                            Authorization Date
                                        </label>
                                        <div class="col-sm-9">
                                            <div class="input-group">
                                                <input class="form-control daterange" data-time-picker="true" data-time-picker-increment="5" data-format="MM/DD/YYYY h:mm A"
                                                       start-date='addPatient.patient.authorizationStartDate' end-date='addPatient.patient.authorizationStartDate'
                                                       name="AuthorizationDate" type="text"
                                                       data-validate="required"  data-message-required="Please enter Authorization Dates.">
                                                <div class="input-group-addon">
                                                    <a href="#">
                                                        <i class="linecons-calendar">
                                                        </i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>-->

                    <!--                    <div class="form-group-separator">
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="EndDate">
                                                End Date
                                            </label>
                                            <div class="col-sm-9">
                                                <div class="input-group">
                                                    <input class="form-control datepicker" data-format="mm/dd/yyyy" id="EndDate" 
                                                           name="EndDate" type="text" ng-model="addPatient.patient.authorizationEndDate"
                                                           data-validate="required"  data-message-required="Please enter End Date." min-date="addPatient.patient.authorizationStartDate" ng-change="addPatient.authorizationDateChanged()">
                                                    <div class="input-group-addon">
                                                        <a href="#">
                                                            <i class="linecons-calendar">
                                                            </i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>-->
                    <div class="form-group-separator">
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <button class="btn btn-info green_bt pull-right" style="width:auto;" type="submit" ng-click="addPatient.setFromNext('tab5')">
                                Next »
                            </button>
                            <button class="btn btn-info green_bt pull-right" style="width:auto;" type="submit" ng-click="addPatient.setFromNext('tab3')">
                                « Previous
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    // validate
    customJqueryValidation();
    jQuery(document).ready(function ($) {
        setTimeout(function () {
            $(".fade-in-effect").addClass('in');
        }, 1);
//        $("#StartDate").datepicker({
//        }).on('changeDate', function(selected) {
//            var startDate = new Date(selected.date.valueOf());
//            $('#EndDate').datepicker('setStartDate', startDate);
//        }).on('clearDate', function(selected) {
//            $('#EndDate').datepicker('setStartDate', null);
//        });
//
//        $("#EndDate").datepicker({
//        }).on('changeDate', function(selected) {
//            var endDate = new Date(selected.date.valueOf());
//            $('#StartDate').datepicker('setEndDate', endDate);
//        }).on('clearDate', function(selected) {
//            $('#StartDate').datepicker('setEndDate', null);
//        });
//
//
////        // Validation
////        $("#add_patient_tab_4_form").validate({
////            rules: {StartDate: {required: true, ontimedate: true},
////                CareType: {required: true},
////                EndDate: {required: true, ontimedate: true},
////                Authorization: {required: true},
////            },
////            messages: {StartDate: {required: 'Please enter Start Date.'},
////                CareType: {required: 'Please select Care Type.'},
////                EndDate: {required: 'Please enter End Date.'},
////                Authorization: {required: 'Please upload Authorization Document.'},
////            },
////            errorPlacement: function(error, element) {
////                if (element.attr("name") == "StartDate" || element.attr("name") == "EndDate") {
////                    error.insertAfter($(element).parent());
////                } else {
////                    error.insertAfter(element);
////                }
////            },
////        }); // validate
//
    });
//</script>
<script type="text/ng-template" id="modal-5">
    <form class="validate form-horizontal" name="careTypeForm" id="care_type_form" >
    <div class="modal-header">
    <button type="button" class="close" ng-click="careTypeModel.cancel();" aria-hidden="true">&times;</button>
    <h4 class="modal-title">{{careTypeModel.title}}</h4>
    </div>

    <div class="modal-body">

    <div class="row">
    <div class="col-xs-12 text-danger">Removing care type will remove any unsaved authorization document associated with the care type.</div>
    <!--<label class="col-sm-4 control-label add-padding-modal" for="rate">
    Authorized hours
    </label>
    <div class="col-sm-8 add-padding-modal">
    <input class="form-control" name="radioRate" maxlength="10" numbers-only="true" decimalallowed type="text" ng-model="careTypeModel.careTypeObj.authorizedHours"  data-validate="required"  data-message-required="Please enter Authorized Hours."> 

    </div>-->
    </div>
    </div>

    <div class="modal-footer">
    <button type="button" class="btn btn-white" ng-click="careTypeModel.cancel();">Close</button>
    <button type="button" class="btn btn-red" ng-show="careTypeModel.showRemove" ng-click="careTypeModel.remove();">Remove</button>
    <!--<button type="submit" class="btn btn-success" ng-click="careTypeModel.save();">Save changes</button>-->
    </div>
    </form>
</script>

<script type="text/ng-template" id="authorization-doc-modal">
    <div class="modal-header">
    <button type="button" class="close" ng-click="close();"><span>×</span></button>
    <h4 class="modal-title" id="myModalLabel">Upload Authorization</h4>
    </div>

    <div>
    <form class="form-horizontal validate" role="form" novalidate="" name="authorizationDoc" id="authorizationDoc" ng-submit="saveAuthorizationDocument();">
    <div class="modal-body" style="padding-bottom:0;">
    <div class="form-group">
    <label class="col-sm-4 control-label" for="careTypes" style="margin-top:15px;">Care Type</label>
    <div class="col-sm-8">
    <select class="form-control" style="margin-top:15px;" name ="careTypes" id="careTypes" ng-model="careObj.careType" ng-options='ct as ct.companyCaretypeId.careTypeTitle for ct in careTypeList' data-message-required="Please select care type." required data-validate="required" ng-change="careObj.errorMsg = null;">
    <option value="">Select Care Type</option>
    </select>
    <div>
    <div ng-show="careObj.errorMsg">
    <span class="red">{{careObj.errorMsg}}</span>
    </div> 
    </div>
    </div>
    </div>
    <div class="form-group-separator"></div>
    <div class="form-group">
    <label class="col-sm-4 control-label add-padding-modal" for="rate">
    Authorized hours
    </label>
    <div class="col-sm-8 add-padding-modal">
    <input class="form-control" name="radioRate" maxlength="10" numbers-only="true" decimalallowed type="text" ng-model="careObj.authorizedHours"  data-validate="required"  data-message-required="Please enter Authorized Hours."> 

    </div>
    </div>
    <div class="form-group-separator"></div>
    <div class="form-group">
    <label class="col-sm-4 control-label add-padding-modal" for="authNumber">
        Authorization Number
    </label>
    <div class="col-sm-8 add-padding-modal">
    <input class="form-control" name="authNumber" maxlength="50" type="text" ng-model="careObj.authorizationNumber"> 
    </div>
    </div>
    <div class="form-group-separator"></div>
    <div class="form-group">
    <label class="col-sm-4 control-label" for="field-2">Authorization</label>
    <div class="col-sm-8">
    <div flow-init="uploadFile" flow-file-added="fileAdded($file, $flow)" flow-file-success="fileUploaded($message,$file,$flow)" flow-files-submitted="fileSelected($file,$flow)" flow-file-error="fileError( $file, $message, $flow )">
    <div class="row">
    <div class="col-sm-12">
    <button type='button' class='btn btn-single gray_bt' id="contract_file" ng-model="fileObj.filePath" flow-btn style="margin-bottom:0px !important" name="contract_file" ng-disabled="disableUploadButton">Choose File</button>
    <div>
    <div ng-show="fileObj.errorMsg != null && fileObj.errorMsg != ''">
    <span class="red">{{fileObj.errorMsg}}</span>
    </div> 
    </div>
    <div flow-transfers class="form-control-static" ng-show="transfers != null && transfers.length > 0 && transfers[0].progress() < 1">
    <div ng-repeat="file in transfers">
    <div id="docFileprogress" class="progress" ng-show="file.progress() < 1 && showfileProgress">
    <div  class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: {{file.progress() * 100}}%;">
    {{file.progress() * 100 | number : 0}} %
    </div>
    </div>
    </div>
    </div>
    </div>
    <div class="col-sm-12" ng-show="viewEditFileMode && (!fileObj.errorMsg)">
    <label class="control-label" style="width:100%;">
    <a style="color: blue;text-decoration: none">
    <span class="" ng-show="fileName && fileName.length > 0" style="max-width:80%;overflow: hidden;text-overflow: ellipsis;position:relative;float:left;">{{fileName}}.{{fileExt}}</span>
    <span ng-show="!fileName || fileName.length === 0" style="float:left;">Untitled.{{fileExt}}</span>
    <button type="button" class="close text-danger" style="float:left;" ng-click="removeFile();">&nbsp;&nbsp;<span>×</span></button>
    </a>
    </label>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div class="form-group-separator" ng-show="viewEditFileMode && (!fileObj.errorMsg)"></div>
    <div class="form-group" ng-show="viewEditFileMode && (!fileObj.errorMsg)">
    <label class="col-sm-4 control-label add-padding-modal" for="fileName">
    File Name
    </label>
    <div class="col-sm-8 add-padding-modal">
    <input class="form-control" name="fileName" id="fileName" type="text" ng-model="fileName"  data-validate="required"  data-message-required="Please enter file name."> 
    </div>
    </div>
    <div class="form-group-separator"></div>
    <div class="form-group">
    <label class="col-sm-4 control-label" for="field-2">Start Of Care</label>
    <div class="col-sm-8">
    <div class="input-group" style="z-index:1060">
    <input type="text" class="form-control datepicker" name="authStartDate" data-format="mm/dd/yyyy" ng-model="careObj.startDate" max-date="careObj.expiryDate">

    <div class="input-group-addon">
    <a href=""><i class="linecons-calendar"></i></a>
    </div>
    </div>
    </div>
    </div>
    <div class="form-group-separator"></div>
    <div class="form-group">
    <label class="col-sm-4 control-label" for="field-2">Expiration Date</label>
    <div class="col-sm-8">
    <div class="input-group" style="z-index:1060">
    <input type="text" class="form-control datepicker" name="fromDate" data-format="mm/dd/yyyy" ng-model="careObj.expiryDate" min-date="careObj.startDate" ng-change="authorizationEndDateChanged();" data-validate="required,date"  data-message-required="Please select Expiration Date." required>

    <div class="input-group-addon">
    <a href=""><i class="linecons-calendar"></i></a>
    </div>
    </div>
    </div>
    </div>

    </div>
    <div class="modal-footer">
    <button type="button" class="btn btn-default btn-default-bootstrap" ng-disabled="disableUploadButton" ng-click="close();">Close</button>
    <button type="submit" class="btn btn-success"  ng-disabled="disableUploadButton">Save changes</button>
    </div>
    </form>
    </div>        
</script>
