
<div class="login-container" ng-controller='loginCtrlr'>
  <div class="row" style="max-width:500px; margin:auto;">
    <div class="col-sm-12"> 
      <script type="text/javascript">
					jQuery(document).ready(function($)
					{
						// Reveal Login form
						setTimeout(function(){ $(".fade-in-effect").addClass('in'); }, 1);
	
	
						// Validation and Ajax action
						$("form#login").validate({
							rules: {
								username: {
									required: true
								},
	
								password: {
									required: true
								},
								orgCode: {
									required: true
								}
							},
	
							messages: {
								username: {
									required: 'Please enter your username.'
								},
	
								password: {
									required: 'Please enter your password.'
								},
								orgCode: {
									required: 'Please enter Company Code.'
								}
							},
	
						});
	
						// Set Form focus
						$("form#login .form-group:has(.form-control):first .form-control").focus();
					});
				</script> 
      
      <!-- Errors container -->
      <div class="errors-container"> </div>
      
      <!-- Add class "fade-in-effect" for login form effect -->
      <form method="post" role="form" id="login" name='login' class="login-form fade-in-effect validate" ng-submit='submitHandler();'>
        <div class="login-header"> <a href="#" class="logo"> <img src="assets/images/logo-white-bg@2x.png" alt="" width="80" /> <span>log in</span> </a>
          <p>Dear user, log in to access the admin area!</p>
        </div>
        <div class="form-group">
          <label class="control-label" for="username">Username</label>
          <input type="text" class="form-control" name="username" id="username" autocomplete="off" ng-model='username'  />
        </div>
        <div class="form-group">
          <label class="control-label" for="password">Password</label>
          <input type="password" class="form-control" name="password" id="password" autocomplete="off" ng-model='password' />
        </div>
        <div class="form-group">
          <label class="control-label" for="orgCode">Company Code</label>
          <input type="text" class="form-control" name="orgCode" id="orgCode" autocomplete="off" ng-model='orgCode' />
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary  btn-block text-left" > <i class="fa-lock"></i> Log In </button>
        </div>
        <div class="login-footer"> <a href="#">Forgot your password?</a>
          <div class="info-links"> <a href="#">ToS</a> - <a href="#">Privacy Policy</a> </div>
        </div>
      </form>
      <!-- External login --> 
      
    </div>
  </div>
</div>


<script>
function loginCtrlr($scope, $rootScope, $http) {
  $scope.submitHandler =  function(){

  	if ($("form#login").valid()) {
		showLoadingBar(70); // Fill progress bar to 70% (just a given value)

		var opts = {
			"closeButton": true,
			"debug": false,
			"positionClass": "toast-top-full-width",
			"onclick": null,
			"showDuration": "300",
			"hideDuration": "1000",
			"timeOut": "5000",
			"extendedTimeOut": "1000",
			"showEasing": "swing",
			"hideEasing": "linear",
			"showMethod": "fadeIn",
			"hideMethod": "fadeOut"
		};
	
		$http({
			url: "/OnTime/api/login",
			method: 'POST',
			data: {
				do_login: true,
				username: $scope.username,
				password: $scope.password,
				orgCode: $scope.orgCode,
			},
			headers: {'Content-Type': 'application/x-www-form-urlencoded'}, 
			transformRequest: function(data) {
				return $.param(data); // jquery util
			}
		}).success(function(data, status, headers, config) {
			showLoadingBar({
				delay: .5,
				pct: 100,
				finish: function(){
					if(data.status == 's') {
						appData.authResult = data;
						window.location.hash = '#/app/dashboard-variant-1';
						// window.location.hash = '#/app/add_patient_tab_1';
					}
				}
			});
										
			// Remove any alert
			$(".errors-container .alert").slideUp('fast');
	
			// Show errors
			if(data.status != 's') {
				$(".errors-container").html('<div class="alert alert-danger">\
					<button type="button" class="close" data-dismiss="alert">\
						<span aria-hidden="true">&times;</span>\
						<span class="sr-only">Close</span>\
					</button>\
					' + data.msg + '\
				</div>');


				$(".errors-container .alert").hide().slideDown();
				//$(form).find('#password').select();
			}
		}).error(function(data, status, headers, config) {
				alert("Error");
				// window.location.hash = '#/app/dashboard-variant-1';
		}); // end of http post
	  } // end o form valid
	}; // end of submitHandler
} // end of controller
</script>
